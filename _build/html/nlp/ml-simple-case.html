

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2. Machine Learning: A Simple Example &#8212; ENC2045 Computational Linguistics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mycss.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'nlp/ml-simple-case';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Classification Models" href="ml-algorithm.html" />
    <link rel="prev" title="1. Machine Learning: Overview" href="ml-overview.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/ntnu-word-2.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/ntnu-word-2.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">INTRODUCTION</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="nlp-primer.html">Natural Language Processing: A Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlp-pipeline.html">NLP Pipeline</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Preprocessing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="text-preprocessing.html">Text Preprocessing</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="text-normalization-eng.html">Text Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="text-tokenization.html">Text Tokenization</a></li>
<li class="toctree-l2"><a class="reference internal" href="text-enrichment.html">Text Enrichment</a></li>
<li class="toctree-l2"><a class="reference internal" href="chinese-word-seg.html">Chinese Word Segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="google-colab.html">Google Colab</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Text Vectorization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="text-vec-traditional.html">Text Vectorization Using Traditional Methods</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning Basics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ml-overview.html">1. Machine Learning: Overview</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. Machine Learning: A Simple Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-algorithm.html">3. Classification Models</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine-Learning NLP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ml-sklearn-classification.html">1. Sentiment Analysis Using Bag-of-Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml-emsemble-learning.html">2. Emsemble Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="topic-modeling-naive.html">3. Topic Modeling: A Naive Example</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Deep Learning NLP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="dl-neural-network-from-scratch.html">1. Neural Network From Scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="dl-simple-case.html">2. Deep Learning: A Simple Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="dl-sentiment-case.html">3. Deep Learning: Sentiment Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Neural Language Model and Embeddings</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="dl-sequence-models-intuition.html">1. Sequence Models Intuition</a></li>
<li class="toctree-l1"><a class="reference internal" href="dl-neural-language-model-primer.html">2. Neural Language Model: A Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="text-vec-embedding.html">3. Word Embeddings</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Sequence Models, Attention, Transformers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="dl-attention-transformer-intuition.html">1. Attention and Transformers: Intuitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="dl-seq-to-seq-attention-addition.html">2. Sequence Model with Attention for Addition Learning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">LLM</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="langchain-llm-intro.html">Large Language Model (Under Construction…)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dl-fine-tuning-bert.html">Transfer Learning Using BERT</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../exercise/1-python-basics.html">1. Assignment I: Python Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise/3-preprocessing.html">2. Assignment II: Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise/4-chinese-nlp.html">3. Assignment III: Chinese Language Processing</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/alvinntnu/NTNU_ENC2045_LECTURES/blob/main/nlp/ml-simple-case.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/nlp/ml-simple-case.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Machine Learning: A Simple Example</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-example-name-gender-prediction">2.1. A Quick Example: Name Gender Prediction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-data">Prepare Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">Feature Engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split">Train-Test Split</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-the-model">Train the Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-the-model">Evaluate the Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-prediction">Model Prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#post-hoc-analysis-interpreting-the-model">Post-hoc Analysis (Interpreting the model)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-can-we-improve-the-model-classifier">2.2. How can we improve the model/classifier?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-sophisticated-feature-engineering">More Sophisticated Feature Engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-development-test-data-splits-for-error-analysis">Train-Development-Test Data Splits for Error Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation">Cross Validation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#try-different-machine-learning-algorithms">Try Different Machine Learning Algorithms</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#try-maxent-classifier">Try Maxent Classifier</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#try-decision-tree">Try Decision Tree</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#try-sklearn-classifiers">2.3. Try <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> Classifiers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-bayes-in-sklearn">Naive Bayes in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression-in-sklearn">Logistic Regression in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#support-vector-machine-in-sklearn">Support Vector Machine in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remaining-issues">2.4. Remaining Issues</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">2.5. References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="machine-learning-a-simple-example">
<h1><a class="toc-backref" href="#id1"><span class="section-number">2. </span>Machine Learning: A Simple Example</a><a class="headerlink" href="#machine-learning-a-simple-example" title="Permalink to this headline">#</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#machine-learning-a-simple-example" id="id1">Machine Learning: A Simple Example</a></p>
<ul>
<li><p><a class="reference internal" href="#a-quick-example-name-gender-prediction" id="id2">A Quick Example: Name Gender Prediction</a></p>
<ul>
<li><p><a class="reference internal" href="#prepare-data" id="id3">Prepare Data</a></p></li>
<li><p><a class="reference internal" href="#feature-engineering" id="id4">Feature Engineering</a></p></li>
<li><p><a class="reference internal" href="#train-test-split" id="id5">Train-Test Split</a></p></li>
<li><p><a class="reference internal" href="#train-the-model" id="id6">Train the Model</a></p></li>
<li><p><a class="reference internal" href="#evaluate-the-model" id="id7">Evaluate the Model</a></p></li>
<li><p><a class="reference internal" href="#model-prediction" id="id8">Model Prediction</a></p></li>
<li><p><a class="reference internal" href="#post-hoc-analysis-interpreting-the-model" id="id9">Post-hoc Analysis (Interpreting the model)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-can-we-improve-the-model-classifier" id="id10">How can we improve the model/classifier?</a></p>
<ul>
<li><p><a class="reference internal" href="#more-sophisticated-feature-engineering" id="id11">More Sophisticated Feature Engineering</a></p></li>
<li><p><a class="reference internal" href="#train-development-test-data-splits-for-error-analysis" id="id12">Train-Development-Test Data Splits for Error Analysis</a></p></li>
<li><p><a class="reference internal" href="#cross-validation" id="id13">Cross Validation</a></p></li>
<li><p><a class="reference internal" href="#try-different-machine-learning-algorithms" id="id14">Try Different Machine Learning Algorithms</a></p>
<ul>
<li><p><a class="reference internal" href="#try-maxent-classifier" id="id15">Try Maxent Classifier</a></p></li>
<li><p><a class="reference internal" href="#try-decision-tree" id="id16">Try Decision Tree</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#try-sklearn-classifiers" id="id17">Try <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> Classifiers</a></p>
<ul>
<li><p><a class="reference internal" href="#naive-bayes-in-sklearn" id="id18">Naive Bayes in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></p></li>
<li><p><a class="reference internal" href="#logistic-regression-in-sklearn" id="id19">Logistic Regression in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></p></li>
<li><p><a class="reference internal" href="#support-vector-machine-in-sklearn" id="id20">Support Vector Machine in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#remaining-issues" id="id21">Remaining Issues</a></p></li>
<li><p><a class="reference internal" href="#references" id="id22">References</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="a-quick-example-name-gender-prediction">
<h2><a class="toc-backref" href="#id2"><span class="section-number">2.1. </span>A Quick Example: Name Gender Prediction</a><a class="headerlink" href="#a-quick-example-name-gender-prediction" title="Permalink to this headline">#</a></h2>
<p>Let’s assume that we have collected a list of personal names and we have their corresponding gender labels, i.e., whether the name is a male or female one.</p>
<p>The goal of this example is to create a classifier that would automatically classify a given name into either male or female.</p>
<section id="prepare-data">
<h3><a class="toc-backref" href="#id3">Prepare Data</a><a class="headerlink" href="#prepare-data" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>We use the data provided in NLTK. Please download the corpus data if necessary.</p></li>
<li><p>We load the corpus, <code class="docutils literal notranslate"><span class="pre">nltk.corpus.names</span></code> and randomize it before we proceed.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">names</span>
<span class="kn">from</span> <span class="nn">nltk.classify</span> <span class="kn">import</span> <span class="n">apply_features</span>
<span class="kn">import</span> <span class="nn">random</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Colab Only</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nltk_data] Downloading package names to /Users/alvinchen/nltk_data...
[nltk_data]   Package names is already up-to-date!
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labeled_names</span> <span class="o">=</span> <span class="p">([(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;male&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;male.txt&#39;</span><span class="p">)]</span> <span class="o">+</span>
                 <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;female&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;female.txt&#39;</span><span class="p">)])</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">labeled_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-engineering">
<h3><a class="toc-backref" href="#id4">Feature Engineering</a><a class="headerlink" href="#feature-engineering" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Now our <strong>base unit</strong> for classification is a name.</p></li>
<li><p>In <strong>feature engineering</strong>, our goal is to transform the texts (i.e., names) into vectorized representations.</p></li>
<li><p>To start with, let’s represent each text (name) by using its last character as the features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">text_vectorizer</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;last_letter&#39;</span><span class="p">:</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>


<span class="n">text_vectorizer</span><span class="p">(</span><span class="s1">&#39;Shrek&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;last_letter&#39;: &#39;k&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="train-test-split">
<h3><a class="toc-backref" href="#id5">Train-Test Split</a><a class="headerlink" href="#train-test-split" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>We then apply the feature engineering method to every text in the data and split the data into <strong>training</strong> and <strong>testing</strong> sets.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">featuresets</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_vectorizer</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">gender</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">gender</span><span class="p">)</span> <span class="ow">in</span> <span class="n">labeled_names</span><span class="p">]</span>
<span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span> <span class="o">=</span> <span class="n">featuresets</span><span class="p">[</span><span class="mi">500</span><span class="p">:],</span> <span class="n">featuresets</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Now all the training/testing tokens are included in a <strong>list</strong>.</p></li>
<li><p>Each training token (i.e., base unit) is encoded as a <strong>tuple</strong> of <code class="docutils literal notranslate"><span class="pre">(feature</span> <span class="pre">dictionary,</span> <span class="pre">string)</span></code>, where we have its features represented as a <strong>dictionary</strong>, and its label as a <strong>string</strong>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_set</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[({&#39;last_letter&#39;: &#39;y&#39;}, &#39;female&#39;),
 ({&#39;last_letter&#39;: &#39;d&#39;}, &#39;male&#39;),
 ({&#39;last_letter&#39;: &#39;a&#39;}, &#39;female&#39;),
 ({&#39;last_letter&#39;: &#39;e&#39;}, &#39;female&#39;),
 ({&#39;last_letter&#39;: &#39;a&#39;}, &#39;female&#39;)]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Please note that in <code class="docutils literal notranslate"><span class="pre">NLTK</span></code>, we can use the <code class="docutils literal notranslate"><span class="pre">apply_features</span></code> to create training and testing datasets.</p></li>
<li><p>When you have a very large feature set, this can be more effective in terms of memory management.</p></li>
</ul>
<ul class="simple">
<li><p>This is our earlier method of creating training and testing sets:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">featuresets</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_vectorizer</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">gender</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">gender</span><span class="p">)</span> <span class="ow">in</span> <span class="n">labeled_names</span><span class="p">]</span>
<span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span> <span class="o">=</span> <span class="n">featuresets</span><span class="p">[</span><span class="mi">500</span><span class="p">:],</span> <span class="n">featuresets</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># train_set = apply_features(text_vectorizer, labeled_names[500:])</span>
<span class="c1"># test_set = apply_features(text_vectorizer, labeled_names[:500])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="train-the-model">
<h3><a class="toc-backref" href="#id6">Train the Model</a><a class="headerlink" href="#train-the-model" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>A good start is to try the simple Naive Bayes Classifier.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifier</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">NaiveBayesClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluate-the-model">
<h3><a class="toc-backref" href="#id7">Evaluate the Model</a><a class="headerlink" href="#evaluate-the-model" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>After we train the model, we need to evaluate its performance on the testing dataset.</p></li>
<li><p>Model evaluation usually involves comparing the predictions provided by the model with the correct answers/labels.</p></li>
<li><p>The evaluation results are often summarized in a <strong>confusion matrix</strong>.</p></li>
</ul>
<p><img alt="" src="../_images/confusion-matrix.jpeg" /></p>
<ul class="simple">
<li><p>Confusion Matrix:</p>
<ul>
<li><p><strong>True positives</strong> are relevant items that we correctly identified as relevant.</p></li>
<li><p><strong>True negatives</strong> are irrelevant items that we correctly identified as irrelevant.</p></li>
<li><p><strong>False positives</strong> (or Type I errors) are irrelevant items that we incorrectly identified as relevant.</p></li>
<li><p><strong>False negatives</strong> (or Type II errors) are relevant items that we incorrectly identified as irrelevant.</p></li>
</ul>
</li>
</ul>
<ul>
<li><p>Given these four numbers, we can define the following model evaluation metrics:</p>
<ul class="simple">
<li><p><strong>Accuracy</strong>: How many items were correctly classified, i.e., <span class="math notranslate nohighlight">\(\frac{TP + TN}{N}\)</span></p></li>
<li><p><strong>Precision</strong>: How many of the items identified by the classifier as relevant are indeed relevant, i.e., <span class="math notranslate nohighlight">\(\frac{TP}{TP+FP}\)</span>.</p></li>
<li><p><strong>Recall</strong>: How many of the true relevant items were successfully identified by the classifier, i.e., <span class="math notranslate nohighlight">\(\frac{TP}{TP+FN}\)</span>.</p></li>
<li><p><strong>F-Measure (or F-Score)</strong>: the harmonic mean of the precision and recall,i.e.:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ 
    F= \frac{(2 × Precision × Recall)}{(Precision + Recall)} 
    \]</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When dealing with imbalanced class distributions, we need to take into account the baseline performance in our model evaluation. For example. if the distribution of <code class="docutils literal notranslate"><span class="pre">Class</span> <span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">Class</span> <span class="pre">1</span></code> is 9:1, then a naive classifier might as well classify all cases as <code class="docutils literal notranslate"><span class="pre">Class</span> <span class="pre">0</span></code>, yielding a high-<strong>precision</strong> performance (i.e., Precision = 90%).</p>
<p>Given this baseline, to better evaluate the classifier on imbalanced dataset, probably the classifier’s <strong>recall rates</strong> are more important.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Precision, Recall, and F-measure</strong></p>
<p>In machine learning, precision and recall are two important metrics used to evaluate the performance of a classifier. Precision measures the proportion of correctly predicted positive instances among all instances predicted as positive, while recall measures the proportion of correctly predicted positive instances among all actual positive instances. Sometimes, it’s challenging to optimize both precision and recall simultaneously during model training because increasing one may lead to a decrease in the other. For example, making the classifier more conservative can improve precision but lower recall, and vice versa. This trade-off between precision and recall highlights the importance of using a metric that considers both aspects simultaneously, such as the F measure. The F measure combines precision and recall into a single score, providing a balanced assessment of a classifier’s performance without favoring one metric over the other. Therefore, in scenarios where precision and recall cannot be optimized simultaneously, the F measure becomes crucial for evaluating the classifier’s effectiveness.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy: </span><span class="si">{:4.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy: 0.76
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Compute the Confusion Matrix</span>
<span class="n">t_f</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test_set</span><span class="p">]</span>  <span class="c1"># features of test set</span>
<span class="n">t_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test_set</span><span class="p">]</span>  <span class="c1"># labels of test set</span>
<span class="n">t_l_pr</span> <span class="o">=</span> <span class="p">[</span><span class="n">classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">t_f</span><span class="p">]</span>  <span class="c1"># predicted labels of test set</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">ConfusionMatrix</span><span class="p">(</span><span class="n">t_l</span><span class="p">,</span> <span class="n">t_l_pr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">ConfusionMatrix</span><span class="p">(</span><span class="n">t_l</span><span class="p">,</span> <span class="n">t_l_pr</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">pretty_format</span><span class="p">(</span><span class="n">sort_by_count</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_percents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">9</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">pretty_format</span><span class="p">(</span><span class="n">sort_by_count</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_percents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       |   f     |
       |   e     |
       |   m   m |
       |   a   a |
       |   l   l |
       |   e   e |
-------+---------+
female |&lt;264&gt; 61 |
  male |  57&lt;118&gt;|
-------+---------+
(row = reference; col = test)

       |      f        |
       |      e        |
       |      m      m |
       |      a      a |
       |      l      l |
       |      e      e |
-------+---------------+
female | &lt;52.8%&gt; 12.2% |
  male |  11.4% &lt;23.6%&gt;|
-------+---------------+
(row = reference; col = test)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## wrap as a function</span>
<span class="k">def</span> <span class="nf">createCM</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">):</span>
    <span class="n">t_f</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test_set</span><span class="p">]</span>
    <span class="n">t_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test_set</span><span class="p">]</span>
    <span class="n">t_l_pr</span> <span class="o">=</span> <span class="p">[</span><span class="n">classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">t_f</span><span class="p">]</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">ConfusionMatrix</span><span class="p">(</span><span class="n">t_l</span><span class="p">,</span> <span class="n">t_l_pr</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">pretty_format</span><span class="p">(</span><span class="n">sort_by_count</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_percents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">createCM</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       |      f        |
       |      e        |
       |      m      m |
       |      a      a |
       |      l      l |
       |      e      e |
-------+---------------+
female | &lt;52.8%&gt; 12.2% |
  male |  11.4% &lt;23.6%&gt;|
-------+---------------+
(row = reference; col = test)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can also get confusion matrix statistics from <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">confusion_matrix</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ConfusionMatrixDisplay</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">classification_report</span></code></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">## label names</span>
<span class="n">target_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">,</span> <span class="s1">&#39;male&#39;</span><span class="p">]</span>
<span class="c1">## confusion matrix</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span> <span class="o">=</span> <span class="n">t_l</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">t_l_pr</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">target_names</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
<span class="c1">## plotting</span>
<span class="n">disp</span> <span class="o">=</span> <span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">=</span> <span class="n">cm</span><span class="p">,</span>
                              <span class="n">display_labels</span><span class="o">=</span> <span class="n">target_names</span><span class="p">)</span>    

<span class="n">disp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[264  61]
 [ 57 118]]
</pre></div>
</div>
<img alt="../_images/0f5fea3cdf0f0dfb79b62c18cb299e59fea92fca814e873998831a7521bee652.png" src="../_images/0f5fea3cdf0f0dfb79b62c18cb299e59fea92fca814e873998831a7521bee652.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## confusion matrix report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_true</span> <span class="o">=</span> <span class="n">t_l</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">t_l_pr</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;female&#39;</span><span class="p">,</span><span class="s1">&#39;male&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              precision    recall  f1-score   support

      female       0.82      0.81      0.82       325
        male       0.66      0.67      0.67       175

    accuracy                           0.76       500
   macro avg       0.74      0.74      0.74       500
weighted avg       0.77      0.76      0.76       500
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Accuracy</span>
<span class="nb">print</span><span class="p">((</span><span class="mi">272</span><span class="o">+</span><span class="mi">124</span><span class="p">)</span><span class="o">/</span><span class="mi">500</span><span class="p">)</span>

<span class="c1">## macro F measures</span>
<span class="nb">print</span><span class="p">((</span><span class="mf">0.84</span> <span class="o">+</span> <span class="mf">0.70</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">## weighted F measures</span>
<span class="nb">print</span><span class="p">(</span><span class="mf">0.84</span><span class="o">*</span><span class="p">(</span><span class="mi">315</span><span class="o">/</span><span class="p">(</span><span class="mi">315</span><span class="o">+</span><span class="mi">185</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.70</span> <span class="o">*</span> <span class="p">(</span><span class="mi">185</span><span class="o">/</span><span class="p">(</span><span class="mi">315</span><span class="o">+</span><span class="mi">185</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.792
0.77
0.7882
</pre></div>
</div>
</div>
</div>
<div class="dropdown admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <strong>macro-averaged</strong> F1 score (or macro F1 score) is computed using the arithmetic mean (aka unweighted mean) of all the per-class F1 scores. This method treats all classes equally regardless of their class distributions.</p></li>
<li><p>The <strong>weighted-averaged</strong> F1 score is calculated by taking the mean of all per-class F1 scores while considering each class’s distribution in the dataset. The “weight” essentially refers to the proportion of each class’s token numbers relative to the sum of the entire dataset.</p></li>
<li><p>Which metrics should be more crucial to your evaluation?</p>
<ul>
<li><p>If you’re dealing with an imbalanced dataset where all classes are equally important, go for the <strong>macro-averaged</strong> F1 score.</p></li>
<li><p>If your dataset is imbalanced, but you want to give more importance to classes with more examples, go for the <strong>weighted-averaged</strong> F1 score.</p></li>
<li><p>If you have a balanced dataset and want a straightforward metric for overall performance, you can use accuracy, which is sometimes referred to as <strong>micro</strong> F1 score.</p></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="model-prediction">
<h3><a class="toc-backref" href="#id8">Model Prediction</a><a class="headerlink" href="#model-prediction" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>After we obtain a classifier, we can use it for (new) case predictions.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">text_vectorizer</span><span class="p">(</span><span class="s1">&#39;Alvino&#39;</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">text_vectorizer</span><span class="p">(</span><span class="s1">&#39;Trinity&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>male
female
</pre></div>
</div>
</div>
</div>
</section>
<section id="post-hoc-analysis-interpreting-the-model">
<h3><a class="toc-backref" href="#id9">Post-hoc Analysis (Interpreting the model)</a><a class="headerlink" href="#post-hoc-analysis-interpreting-the-model" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>One of the most important steps after model training is to examine which features contribute the most to the classifier prediction of the class.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifier</span><span class="o">.</span><span class="n">show_most_informative_features</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Most Informative Features
             last_letter = &#39;a&#39;            female : male   =     33.3 : 1.0
             last_letter = &#39;k&#39;              male : female =     32.5 : 1.0
             last_letter = &#39;f&#39;              male : female =     17.2 : 1.0
             last_letter = &#39;p&#39;              male : female =     12.5 : 1.0
             last_letter = &#39;v&#39;              male : female =     10.5 : 1.0
             last_letter = &#39;o&#39;              male : female =      9.4 : 1.0
             last_letter = &#39;d&#39;              male : female =      9.3 : 1.0
             last_letter = &#39;m&#39;              male : female =      7.7 : 1.0
             last_letter = &#39;r&#39;              male : female =      6.7 : 1.0
             last_letter = &#39;w&#39;              male : female =      5.4 : 1.0
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="how-can-we-improve-the-model-classifier">
<h2><a class="toc-backref" href="#id10"><span class="section-number">2.2. </span>How can we improve the model/classifier?</a><a class="headerlink" href="#how-can-we-improve-the-model-classifier" title="Permalink to this headline">#</a></h2>
<p>In the following, we will talk about methods that we may consider to further improve the model training.</p>
<ul class="simple">
<li><p>Feature Engineering</p></li>
<li><p>Error Analysis</p></li>
<li><p>Cross Validation</p></li>
<li><p>Try Different Machine-Learning Algorithms</p></li>
<li><p>(Ensemble Methods)</p></li>
</ul>
<section id="more-sophisticated-feature-engineering">
<h3><a class="toc-backref" href="#id11">More Sophisticated Feature Engineering</a><a class="headerlink" href="#more-sophisticated-feature-engineering" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>We can extract more useful features from the names.</p></li>
<li><p>Use the following features for vectorized representations of names:</p>
<ul>
<li><p>The first/last letter</p></li>
<li><p>Frequencies of all 26 alphabets in the names</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## refine out text vectorizer</span>
<span class="k">def</span> <span class="nf">text_vectorizer2</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;first_letter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">features</span><span class="p">[</span><span class="s2">&quot;last_letter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span><span class="p">:</span>
        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;count(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">letter</span><span class="p">)]</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;has(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">letter</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">letter</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">features</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text_vectorizer2</span><span class="p">(</span><span class="s1">&#39;Alvin&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;first_letter&#39;: &#39;a&#39;,
 &#39;last_letter&#39;: &#39;n&#39;,
 &#39;count(a)&#39;: 1,
 &#39;has(a)&#39;: True,
 &#39;count(b)&#39;: 0,
 &#39;has(b)&#39;: False,
 &#39;count(c)&#39;: 0,
 &#39;has(c)&#39;: False,
 &#39;count(d)&#39;: 0,
 &#39;has(d)&#39;: False,
 &#39;count(e)&#39;: 0,
 &#39;has(e)&#39;: False,
 &#39;count(f)&#39;: 0,
 &#39;has(f)&#39;: False,
 &#39;count(g)&#39;: 0,
 &#39;has(g)&#39;: False,
 &#39;count(h)&#39;: 0,
 &#39;has(h)&#39;: False,
 &#39;count(i)&#39;: 1,
 &#39;has(i)&#39;: True,
 &#39;count(j)&#39;: 0,
 &#39;has(j)&#39;: False,
 &#39;count(k)&#39;: 0,
 &#39;has(k)&#39;: False,
 &#39;count(l)&#39;: 1,
 &#39;has(l)&#39;: True,
 &#39;count(m)&#39;: 0,
 &#39;has(m)&#39;: False,
 &#39;count(n)&#39;: 1,
 &#39;has(n)&#39;: True,
 &#39;count(o)&#39;: 0,
 &#39;has(o)&#39;: False,
 &#39;count(p)&#39;: 0,
 &#39;has(p)&#39;: False,
 &#39;count(q)&#39;: 0,
 &#39;has(q)&#39;: False,
 &#39;count(r)&#39;: 0,
 &#39;has(r)&#39;: False,
 &#39;count(s)&#39;: 0,
 &#39;has(s)&#39;: False,
 &#39;count(t)&#39;: 0,
 &#39;has(t)&#39;: False,
 &#39;count(u)&#39;: 0,
 &#39;has(u)&#39;: False,
 &#39;count(v)&#39;: 1,
 &#39;has(v)&#39;: True,
 &#39;count(w)&#39;: 0,
 &#39;has(w)&#39;: False,
 &#39;count(x)&#39;: 0,
 &#39;has(x)&#39;: False,
 &#39;count(y)&#39;: 0,
 &#39;has(y)&#39;: False,
 &#39;count(z)&#39;: 0,
 &#39;has(z)&#39;: False}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text_vectorizer2</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;first_letter&#39;: &#39;j&#39;,
 &#39;last_letter&#39;: &#39;n&#39;,
 &#39;count(a)&#39;: 0,
 &#39;has(a)&#39;: False,
 &#39;count(b)&#39;: 0,
 &#39;has(b)&#39;: False,
 &#39;count(c)&#39;: 0,
 &#39;has(c)&#39;: False,
 &#39;count(d)&#39;: 0,
 &#39;has(d)&#39;: False,
 &#39;count(e)&#39;: 0,
 &#39;has(e)&#39;: False,
 &#39;count(f)&#39;: 0,
 &#39;has(f)&#39;: False,
 &#39;count(g)&#39;: 0,
 &#39;has(g)&#39;: False,
 &#39;count(h)&#39;: 1,
 &#39;has(h)&#39;: True,
 &#39;count(i)&#39;: 0,
 &#39;has(i)&#39;: False,
 &#39;count(j)&#39;: 1,
 &#39;has(j)&#39;: True,
 &#39;count(k)&#39;: 0,
 &#39;has(k)&#39;: False,
 &#39;count(l)&#39;: 0,
 &#39;has(l)&#39;: False,
 &#39;count(m)&#39;: 0,
 &#39;has(m)&#39;: False,
 &#39;count(n)&#39;: 1,
 &#39;has(n)&#39;: True,
 &#39;count(o)&#39;: 1,
 &#39;has(o)&#39;: True,
 &#39;count(p)&#39;: 0,
 &#39;has(p)&#39;: False,
 &#39;count(q)&#39;: 0,
 &#39;has(q)&#39;: False,
 &#39;count(r)&#39;: 0,
 &#39;has(r)&#39;: False,
 &#39;count(s)&#39;: 0,
 &#39;has(s)&#39;: False,
 &#39;count(t)&#39;: 0,
 &#39;has(t)&#39;: False,
 &#39;count(u)&#39;: 0,
 &#39;has(u)&#39;: False,
 &#39;count(v)&#39;: 0,
 &#39;has(v)&#39;: False,
 &#39;count(w)&#39;: 0,
 &#39;has(w)&#39;: False,
 &#39;count(x)&#39;: 0,
 &#39;has(x)&#39;: False,
 &#39;count(y)&#39;: 0,
 &#39;has(y)&#39;: False,
 &#39;count(z)&#39;: 0,
 &#39;has(z)&#39;: False}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## more sophisticated feature engineering</span>
<span class="n">train_set</span> <span class="o">=</span> <span class="n">apply_features</span><span class="p">(</span><span class="n">text_vectorizer2</span><span class="p">,</span> <span class="n">labeled_names</span><span class="p">[</span><span class="mi">500</span><span class="p">:])</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="n">apply_features</span><span class="p">(</span><span class="n">text_vectorizer2</span><span class="p">,</span> <span class="n">labeled_names</span><span class="p">[:</span><span class="mi">500</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">## more sophisticated feature engineering</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">train_set</span> <span class="o">=</span> <span class="n">apply_features</span><span class="p">(</span><span class="n">text_vectorizer2</span><span class="p">,</span> <span class="n">labeled_names</span><span class="p">[</span><span class="mi">500</span><span class="p">:])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">test_set</span> <span class="o">=</span> <span class="n">apply_features</span><span class="p">(</span><span class="n">text_vectorizer2</span><span class="p">,</span> <span class="n">labeled_names</span><span class="p">[:</span><span class="mi">500</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;apply_features&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## train the model</span>
<span class="n">classifier</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">NaiveBayesClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## evaluate the model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Post-hoc analysis</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">show_most_informative_features</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Most Informative Features
             last_letter = &#39;a&#39;            female : male   =     33.2 : 1.0
             last_letter = &#39;k&#39;              male : female =     31.3 : 1.0
             last_letter = &#39;f&#39;              male : female =     17.3 : 1.0
             last_letter = &#39;p&#39;              male : female =     12.5 : 1.0
             last_letter = &#39;v&#39;              male : female =     10.5 : 1.0
                count(v) = 2              female : male   =      9.6 : 1.0
             last_letter = &#39;d&#39;              male : female =      9.5 : 1.0
             last_letter = &#39;m&#39;              male : female =      8.8 : 1.0
             last_letter = &#39;o&#39;              male : female =      7.8 : 1.0
             last_letter = &#39;r&#39;              male : female =      6.4 : 1.0
             last_letter = &#39;w&#39;              male : female =      4.8 : 1.0
             last_letter = &#39;g&#39;              male : female =      4.8 : 1.0
                count(a) = 3              female : male   =      4.7 : 1.0
            first_letter = &#39;w&#39;              male : female =      4.6 : 1.0
                count(w) = 1                male : female =      4.4 : 1.0
                  has(w) = True             male : female =      4.4 : 1.0
             last_letter = &#39;z&#39;              male : female =      4.3 : 1.0
                count(f) = 2                male : female =      4.1 : 1.0
             last_letter = &#39;s&#39;              male : female =      4.0 : 1.0
             last_letter = &#39;t&#39;              male : female =      4.0 : 1.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="train-development-test-data-splits-for-error-analysis">
<h3><a class="toc-backref" href="#id12">Train-Development-Test Data Splits for Error Analysis</a><a class="headerlink" href="#train-development-test-data-splits-for-error-analysis" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Normally we have <strong>training</strong>-<strong>testing</strong> splits of data</p></li>
<li><p>Sometimes we can use <strong>development (dev)</strong> set for error analysis and feature engineering.</p></li>
<li><p>This dev set should be independent of training and testing sets.</p></li>
</ul>
<ul class="simple">
<li><p>Now let’s train the model on the <strong>training set</strong> and first check the classifier’s performance on the <strong>dev</strong> set.</p></li>
<li><p>We then identify the errors the classifier made in the <strong>dev</strong> set.</p></li>
<li><p>We perform <strong>error analysis</strong> for potential model improvement.</p></li>
<li><p>We only test our <strong>final model</strong> on the testing set. (Note: Testing set can only be used <strong>once</strong>.)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## train-dev-test split</span>
<span class="n">train_names</span> <span class="o">=</span> <span class="n">labeled_names</span><span class="p">[</span><span class="mi">1500</span><span class="p">:]</span>
<span class="n">devtest_names</span> <span class="o">=</span> <span class="n">labeled_names</span><span class="p">[</span><span class="mi">500</span><span class="p">:</span><span class="mi">1500</span><span class="p">]</span>
<span class="n">test_names</span> <span class="o">=</span> <span class="n">labeled_names</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span>

<span class="c1">## Feature engineering</span>
<span class="n">train_set</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_vectorizer2</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">gender</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">gender</span><span class="p">)</span> <span class="ow">in</span> <span class="n">train_names</span><span class="p">]</span>
<span class="n">devtest_set</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_vectorizer2</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">gender</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">gender</span><span class="p">)</span> <span class="ow">in</span> <span class="n">devtest_names</span><span class="p">]</span>
<span class="n">test_set</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_vectorizer2</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">gender</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">gender</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test_names</span><span class="p">]</span>

<span class="c1">## Train the model</span>
<span class="n">classifier</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">NaiveBayesClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>

<span class="c1">## Evaluate the model on dev set</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">devtest_set</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.75
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## identify error cases</span>

<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="n">devtest_names</span><span class="p">:</span>
    <span class="n">guess</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">text_vectorizer2</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">guess</span> <span class="o">!=</span> <span class="n">tag</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tag</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## save error cases for post-hoc analysis</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;error-analysis.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

    <span class="c1"># using csv.writer method from CSV package</span>
    <span class="n">write</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">write</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;tag&#39;</span><span class="p">,</span> <span class="s1">&#39;guess&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">])</span>
    <span class="n">write</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ideally, we can inspect the errors in a spreadsheet and come up with better rules (features) that could help improve the classifier.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">## check first and last N rows</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;error-analysis.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tag</th>
      <th>guess</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>male</td>
      <td>female</td>
      <td>Clayborn</td>
    </tr>
    <tr>
      <th>1</th>
      <td>male</td>
      <td>female</td>
      <td>Davidde</td>
    </tr>
    <tr>
      <th>2</th>
      <td>male</td>
      <td>female</td>
      <td>Sean</td>
    </tr>
    <tr>
      <th>3</th>
      <td>female</td>
      <td>male</td>
      <td>Helen</td>
    </tr>
    <tr>
      <th>4</th>
      <td>female</td>
      <td>male</td>
      <td>Frances</td>
    </tr>
    <tr>
      <th>5</th>
      <td>male</td>
      <td>female</td>
      <td>Isadore</td>
    </tr>
    <tr>
      <th>6</th>
      <td>female</td>
      <td>male</td>
      <td>Dorolice</td>
    </tr>
    <tr>
      <th>7</th>
      <td>male</td>
      <td>female</td>
      <td>Alan</td>
    </tr>
    <tr>
      <th>8</th>
      <td>female</td>
      <td>male</td>
      <td>Brigit</td>
    </tr>
    <tr>
      <th>9</th>
      <td>male</td>
      <td>female</td>
      <td>Merrel</td>
    </tr>
    <tr>
      <th>240</th>
      <td>female</td>
      <td>male</td>
      <td>Trish</td>
    </tr>
    <tr>
      <th>241</th>
      <td>male</td>
      <td>female</td>
      <td>Karl</td>
    </tr>
    <tr>
      <th>242</th>
      <td>male</td>
      <td>female</td>
      <td>Sinclair</td>
    </tr>
    <tr>
      <th>243</th>
      <td>male</td>
      <td>female</td>
      <td>Vince</td>
    </tr>
    <tr>
      <th>244</th>
      <td>male</td>
      <td>female</td>
      <td>Kellen</td>
    </tr>
    <tr>
      <th>245</th>
      <td>male</td>
      <td>female</td>
      <td>Jermayne</td>
    </tr>
    <tr>
      <th>246</th>
      <td>female</td>
      <td>male</td>
      <td>Justin</td>
    </tr>
    <tr>
      <th>247</th>
      <td>female</td>
      <td>male</td>
      <td>Tessy</td>
    </tr>
    <tr>
      <th>248</th>
      <td>male</td>
      <td>female</td>
      <td>Kenny</td>
    </tr>
    <tr>
      <th>249</th>
      <td>male</td>
      <td>female</td>
      <td>Juanita</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="cross-validation">
<h3><a class="toc-backref" href="#id13">Cross Validation</a><a class="headerlink" href="#cross-validation" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>We can also check our average model performance using the cross-validation method on the training dataset before the real testing of the model.</p></li>
<li><p>This method is often useful if you need to fine-tune the hyperparameters during the model training stage.</p></li>
</ul>
<hr class="docutils" />
<p><img alt="" src="../_images/ml-kfold.png" />
(Source: <a class="reference external" href="https://scikit-learn.org/stable/modules/cross_validation.html">https://scikit-learn.org/stable/modules/cross_validation.html</a>)</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sklearn.model_selection</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">acc_kf</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1">## accuracy holder</span>

<span class="c1">## Cross-validation</span>
<span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">train_set</span><span class="p">):</span>
    <span class="c1">#print(&quot;TRAIN:&quot;, train_index, &quot;TEST:&quot;, test_index)</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">NaiveBayesClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">train_set</span><span class="p">[</span><span class="n">train_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">train_index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">train_index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">cur_fold_acc</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span>
        <span class="n">classifier</span><span class="p">,</span> <span class="n">train_set</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">test_index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">acc_kf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_fold_acc</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;accuracy:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">cur_fold_acc</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>accuracy: 0.77
accuracy: 0.76
accuracy: 0.82
accuracy: 0.8
accuracy: 0.79
accuracy: 0.79
accuracy: 0.78
accuracy: 0.76
accuracy: 0.77
accuracy: 0.75
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">acc_kf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7791382108323754
</pre></div>
</div>
</div>
</div>
</section>
<section id="try-different-machine-learning-algorithms">
<h3><a class="toc-backref" href="#id14">Try Different Machine Learning Algorithms</a><a class="headerlink" href="#try-different-machine-learning-algorithms" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>There are many ML algorithms for classification tasks.</p></li>
<li><p>Here we will demonstrate a few more classifiers implemented in NLTK, including:</p>
<ul>
<li><p>Maximum Entropy Classifier (Logistic Regression)</p></li>
<li><p>Decision Tree Classifier</p></li>
</ul>
</li>
<li><p>Also, in NLTK, we can use the classification methods provided in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> as well, including:</p>
<ul>
<li><p>Naive Bayes</p></li>
<li><p>Logistic Regression</p></li>
<li><p>Support Vector Machine</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>When we try another ML algorithm, we do the following:</p>
<ul>
<li><p>train the model</p></li>
<li><p>check model performance (accuracy and confusion matrix)</p></li>
<li><p>check the most informative features</p></li>
<li><p>obtain average performance using <em>k</em>-fold cross validation</p></li>
</ul>
</li>
</ul>
<section id="try-maxent-classifier">
<h4><a class="toc-backref" href="#id15">Try Maxent Classifier</a><a class="headerlink" href="#try-maxent-classifier" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Maxent is memory hungry, slower, and it requires <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="kn">from</span> <span class="nn">nltk.classify</span> <span class="kn">import</span> <span class="n">MaxentClassifier</span>

<span class="c1">## Train Maxent model</span>
<span class="n">classifier_maxent</span> <span class="o">=</span> <span class="n">MaxentClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span>
                                           <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;iis&#39;</span><span class="p">,</span>
                                           <span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                           <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                           <span class="n">min_lldelta</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 40.6 s, sys: 23.9 ms, total: 40.7 s
Wall time: 41.3 s
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default algorithm for training is <code class="docutils literal notranslate"><span class="pre">iis</span></code> (Improved Iterative Scaling). Another alternative is <code class="docutils literal notranslate"><span class="pre">gis</span></code> (General Iterative Scaling), which is faster.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1">## Cross validation on training</span>
<span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">train_set</span><span class="p">):</span>
    <span class="c1">#print(&quot;TRAIN:&quot;, train_index, &quot;TEST:&quot;, test_index)</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">MaxentClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">train_set</span><span class="p">[</span><span class="n">train_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">train_index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">train_index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]],</span>
        <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;gis&#39;</span><span class="p">,</span>
        <span class="n">trace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">min_lldelta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span> <span class="c1">## set smaller value for `min_lldelta`</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s1">&#39;accuracy:&#39;</span><span class="p">,</span>
        <span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span>
            <span class="n">classifier</span><span class="p">,</span>
            <span class="n">train_set</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">test_index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>accuracy: 0.6987577639751553
accuracy: 0.687888198757764
accuracy: 0.6739130434782609
accuracy: 0.7360248447204969
accuracy: 0.713841368584759
accuracy: 0.702954898911353
accuracy: 0.7200622083981337
accuracy: 0.6905132192846034
accuracy: 0.6905132192846034
accuracy: 0.6858475894245724
CPU times: user 1min 37s, sys: 137 ms, total: 1min 37s
Wall time: 1min 37s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## evaluate the model</span>
<span class="n">createCM</span><span class="p">(</span><span class="n">classifier_maxent</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       |      f        |
       |      e        |
       |      m      m |
       |      a      a |
       |      l      l |
       |      e      e |
-------+---------------+
female | &lt;58.0%&gt;  5.0% |
  male |  12.2% &lt;24.8%&gt;|
-------+---------------+
(row = reference; col = test)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## posthoc analysis</span>
<span class="n">classifier_maxent</span><span class="o">.</span><span class="n">show_most_informative_features</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  -3.224 last_letter==&#39;a&#39; and label is &#39;male&#39;
  -2.547 last_letter==&#39;k&#39; and label is &#39;female&#39;
  -2.475 last_letter==&#39;f&#39; and label is &#39;female&#39;
  -2.020 count(v)==2 and label is &#39;male&#39;
  -1.494 last_letter==&#39;v&#39; and label is &#39;female&#39;
   1.483 count(j)==2 and label is &#39;female&#39;
  -1.435 last_letter==&#39;m&#39; and label is &#39;female&#39;
  -1.408 last_letter==&#39;p&#39; and label is &#39;female&#39;
  -1.345 last_letter==&#39;d&#39; and label is &#39;female&#39;
  -1.181 last_letter==&#39;i&#39; and label is &#39;male&#39;
  -1.076 last_letter==&#39;o&#39; and label is &#39;female&#39;
   1.031 last_letter==&#39;c&#39; and label is &#39;male&#39;
  -1.020 first_letter==&#39;x&#39; and label is &#39;female&#39;
  -0.985 count(p)==3 and label is &#39;male&#39;
   0.931 count(h)==3 and label is &#39;male&#39;
  -0.900 last_letter==&#39;r&#39; and label is &#39;female&#39;
  -0.847 count(i)==3 and label is &#39;female&#39;
  -0.794 count(e)==3 and label is &#39;male&#39;
   0.774 count(g)==3 and label is &#39;male&#39;
   0.690 count(u)==3 and label is &#39;male&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="try-decision-tree">
<h4><a class="toc-backref" href="#id16">Try Decision Tree</a><a class="headerlink" href="#try-decision-tree" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Parameters:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">binary</span></code>: whether the features are binary</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">entropy_cutoff</span></code>: a value used during tree refinement process</p>
<ul>
<li><p>entropy = 1 -&gt; high-level uncertainty</p></li>
<li><p>entropy = 0 -&gt; perfect model prediction</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">depth_cutoff</span></code>: to control the depth of the tree</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">support_cutoff</span></code>: the minimum number of instances that are required to make a decision about a feature.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1">## Train decision tree model</span>
<span class="kn">from</span> <span class="nn">nltk.classify</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="n">classifier_dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span>
                                             <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="n">entropy_cutoff</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                             <span class="n">depth_cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                             <span class="n">support_cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 4.02 s, sys: 1.89 ms, total: 4.02 s
Wall time: 4.1 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1">## cross-validation on training </span>
<span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">train_set</span><span class="p">):</span>
    <span class="c1">#print(&quot;TRAIN:&quot;, train_index, &quot;TEST:&quot;, test_index)</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">train_set</span><span class="p">[</span><span class="n">train_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">train_index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">train_index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]],</span>
        <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">entropy_cutoff</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">depth_cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">support_cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s1">&#39;accuracy:&#39;</span><span class="p">,</span>
        <span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span>
            <span class="n">classifier</span><span class="p">,</span>
            <span class="n">train_set</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">test_index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>accuracy: 0.7111801242236024
accuracy: 0.6956521739130435
accuracy: 0.7049689440993789
accuracy: 0.7329192546583851
accuracy: 0.7231726283048211
accuracy: 0.7200622083981337
accuracy: 0.7247278382581649
accuracy: 0.7262830482115086
accuracy: 0.7356143079315708
accuracy: 0.7107309486780715
CPU times: user 1min 19s, sys: 121 ms, total: 1min 19s
Wall time: 1min 19s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## evaluate the model on test data</span>
<span class="n">createCM</span><span class="p">(</span><span class="n">classifier_dt</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       |      f        |
       |      e        |
       |      m      m |
       |      a      a |
       |      l      l |
       |      e      e |
-------+---------------+
female | &lt;61.2%&gt;  1.8% |
  male |  22.8% &lt;14.2%&gt;|
-------+---------------+
(row = reference; col = test)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## posthoc </span>
<span class="nb">print</span><span class="p">(</span><span class="n">classifier_dt</span><span class="o">.</span><span class="n">pretty_format</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>last_letter=d? ........................................ male
else: ................................................. male
  last_letter=r? ...................................... male
    first_letter=j? ................................... male
      count(n)=0? ..................................... male
      else: ........................................... female
    else: ............................................. male
      first_letter=e? ................................. female
        count(t)=0? ................................... male
        else: ......................................... female
      else: ........................................... male
  else: ............................................... male
    last_letter=o? .................................... male
    else: ............................................. male
      last_letter=s? .................................. female
        first_letter=p? ............................... female
        else: ......................................... male
      else: ........................................... male
        count(w)=0? ................................... female
        else: ......................................... male
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="try-sklearn-classifiers">
<h2><a class="toc-backref" href="#id17"><span class="section-number">2.3. </span>Try <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> Classifiers</a><a class="headerlink" href="#try-sklearn-classifiers" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> is a very useful module for machine learning. We will talk more about this module in our later lectures.</p></li>
<li><p>This package provides a lot more ML algorithms for classification tasks.</p></li>
</ul>
<section id="naive-bayes-in-sklearn">
<h3><a class="toc-backref" href="#id18">Naive Bayes in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a><a class="headerlink" href="#naive-bayes-in-sklearn" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nltk.classify.scikitlearn</span> <span class="kn">import</span> <span class="n">SklearnClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span>


<span class="c1">## Using sklearn naive bayes in nltk</span>
<span class="n">sk_classifier</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">MultinomialNB</span><span class="p">())</span>
<span class="n">sk_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SklearnClassifier(MultinomialNB())&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## evaluate model</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">sk_classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.82
</pre></div>
</div>
</div>
</div>
</section>
<section id="logistic-regression-in-sklearn">
<h3><a class="toc-backref" href="#id19">Logistic Regression in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a><a class="headerlink" href="#logistic-regression-in-sklearn" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1">## using sklearn logistic regression in nltk</span>
<span class="n">sk_classifier</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
<span class="n">sk_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>

<span class="c1">## evaluate the model</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">sk_classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
<span class="c1"># createCM(sk_classifier, test_set)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       |      f        |
       |      e        |
       |      m      m |
       |      a      a |
       |      l      l |
       |      e      e |
-------+---------------+
female | &lt;56.4%&gt;  6.6% |
  male |  11.0% &lt;26.0%&gt;|
-------+---------------+
(row = reference; col = test)
</pre></div>
</div>
</div>
</div>
</section>
<section id="support-vector-machine-in-sklearn">
<h3><a class="toc-backref" href="#id20">Support Vector Machine in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a><a class="headerlink" href="#support-vector-machine-in-sklearn" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> provides several implementations for Support Vector Machines.</p></li>
<li><p>Please see its documentation for more detail: <a class="reference external" href="https://scikit-learn.org/stable/modules/svm.html">Support Vector Machine</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>

<span class="c1">## using sklearn SVM in nltk</span>
<span class="n">sk_classifier</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">SVC</span><span class="p">())</span>
<span class="n">sk_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>

<span class="c1">## evaluate the model</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">sk_classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
<span class="c1"># createCM(sk_classifier, test_set)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       |      f        |
       |      e        |
       |      m      m |
       |      a      a |
       |      l      l |
       |      e      e |
-------+---------------+
female | &lt;57.4%&gt;  5.6% |
  male |   8.6% &lt;28.4%&gt;|
-------+---------------+
(row = reference; col = test)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>

<span class="c1">## using sklearn linear SVM in nltk</span>
<span class="n">sk_classifier</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">LinearSVC</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">sk_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>

<span class="c1">## evaluate model</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">sk_classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.82
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">NuSVC</span>

<span class="c1">## using sklearn linear nuSVM in nltk</span>
<span class="n">sk_classifier</span> <span class="o">=</span> <span class="n">SklearnClassifier</span><span class="p">(</span><span class="n">NuSVC</span><span class="p">())</span>
<span class="n">sk_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>
<span class="c1">## evaluate model</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">sk_classifier</span><span class="p">,</span> <span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.85
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="remaining-issues">
<h2><a class="toc-backref" href="#id21"><span class="section-number">2.4. </span>Remaining Issues</a><a class="headerlink" href="#remaining-issues" title="Permalink to this headline">#</a></h2>
<ol class="arabic simple">
<li><p><strong>Feature Engineering</strong>: Feature engineering is highlighted as a crucial aspect of the machine learning process. This involves selecting, extracting, and transforming features from the raw data to create meaningful representations that can improve the performance of the model.</p></li>
<li><p><strong>Linguistically Motivated Features</strong>: There is a suggestion to include more linguistically motivated features during the feature engineering process. This implies that domain-specific knowledge and linguistic insights can be valuable in designing features that capture relevant information from the data.</p></li>
<li><p><strong>Text Vectorization Quality</strong>: The quality of text vectorization is emphasized as it greatly influences the performance of the classifier. Text vectorization converts textual data into numerical representations that machine learning algorithms can work with. Ensuring accurate and informative vectorization is crucial for effective modeling.</p></li>
<li><p><strong>Hyperparameter Tuning</strong>: Every machine learning algorithm requires setting hyperparameters, which can significantly impact the model’s performance. Tuning these hyperparameters to optimal values is essential for achieving the best possible performance from the model.</p></li>
<li><p><strong>Systematic Hyperparameter Optimization</strong>: There is a need for a more systematic approach to finding the optimal combinations of hyperparameters for a given machine learning algorithm. This suggests the importance of methods such as grid search or randomized search to systematically explore the hyperparameter space and identify the best settings.</p></li>
<li><p><strong>Importance of Sklearn</strong>: We will come back to these issues when discussing machine learning with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>.</p></li>
</ol>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id22"><span class="section-number">2.5. </span>References</a><a class="headerlink" href="#references" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>NLTK Book, <a class="reference external" href="https://www.nltk.org/book/ch06.html">Chapter 6 Learning to Classify Texts</a></p></li>
<li><p>Géron (2019), Chapter 3 Classification</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./nlp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="ml-overview.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Machine Learning: Overview</p>
      </div>
    </a>
    <a class="right-next"
       href="ml-algorithm.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Classification Models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-example-name-gender-prediction">2.1. A Quick Example: Name Gender Prediction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-data">Prepare Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">Feature Engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split">Train-Test Split</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-the-model">Train the Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-the-model">Evaluate the Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-prediction">Model Prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#post-hoc-analysis-interpreting-the-model">Post-hoc Analysis (Interpreting the model)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-can-we-improve-the-model-classifier">2.2. How can we improve the model/classifier?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-sophisticated-feature-engineering">More Sophisticated Feature Engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-development-test-data-splits-for-error-analysis">Train-Development-Test Data Splits for Error Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation">Cross Validation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#try-different-machine-learning-algorithms">Try Different Machine Learning Algorithms</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#try-maxent-classifier">Try Maxent Classifier</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#try-decision-tree">Try Decision Tree</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#try-sklearn-classifiers">2.3. Try <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> Classifiers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-bayes-in-sklearn">Naive Bayes in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression-in-sklearn">Logistic Regression in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#support-vector-machine-in-sklearn">Support Vector Machine in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remaining-issues">2.4. Remaining Issues</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">2.5. References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alvin Cheng-Hsien Chen
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023 Alvin Chen.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>